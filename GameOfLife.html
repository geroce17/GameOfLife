<!DOCTYPE html>
<html lang="es-MX">

<head>
    <meta charset="UFT-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0,maximum-scale=1.0, minimum-scale=.1">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
<div class="container">
    <input id="txtSize" type="text">
    <input type="button" value="Genera una tabla" onclick="genera_tabla()">
    <input type="button" value="inicio" onclick="hazMagia()">
    <label class="col-md-4" id="ex">EX</label>
    <div class="col-md-12">
        <label class="col-md-6" id="ex2">EX2</label>
        <label class="col-md-6" id="ex3">EX3</label>
    </div>
    <section id="tablero">
        <!--Aqui va el codigo generado-->
    </section>
</div>

<script>
    var matriz = new Array(3); //Declaracion global de matriz
    var size; // Obtiene el tama√±o deseado para el tablero (no mas de 150 aprx)
    
    function genera_tabla() {
      // Obtener la referencia del elemento body
      document.getElementById("tablero").innerHTML="";
      var body = document.getElementsByTagName("section")[0];

      // Crea un elemento <table> y un elemento <tbody>
      var tabla   = document.createElement("table");
      var tblBody = document.createElement("tbody");
        
      size = document.getElementById("txtSize").value;
      document.getElementById("ex").textContent=size;
      // Crea las celdas
      for (var i = 0; i < size; i++) {
          matriz[i]=new Array(3);
        // Crea las hileras de la tabla
        var hilera = document.createElement("tr");

        for (var j = 0; j < size; j++) {
          // Crea un elemento <td> y un nodo de texto, haz que el nodo de
          // texto sea el contenido de <td>, ubica el elemento <td> al final
          // de la hilera de la tabla
          var celda = document.createElement("td");
            celda.onclick = function() {cambiaColor(this)};
            celda.style.backgroundColor = "black";
            celda.style.padding = "3px";
            matriz[i][j]=celda;
          //var textoCelda = document.createTextNode("H "+i+", C "+j);
          //celda.appendChild(textoCelda);
          hilera.appendChild(celda);
        }

        // agrega la hilera al final de la tabla (al final del elemento tblbody)
        tblBody.appendChild(hilera);
      }

      // posiciona el <tbody> debajo del elemento <table>
      tabla.appendChild(tblBody);
      // appends <table> into <body>
      body.appendChild(tabla);
      // modifica el atributo "border" de la tabla y lo fija a "2";
      tabla.setAttribute("border", ".1");
    }

function hazMagia()
{
    document.getElementById("ex2").textContent=size;
    var el, up, down, right, left, dls, dli, drs,dri, val, antEL, antVal, cont;
    var asigRes = new Array();
    var asigKill = new Array();
    
    //document.getElementById("ex").innerHTML=asigRes.length;
    //document.getElementById("ex2").innerHTML= asigKill.length;
    
    for(var r = 0; r <=size-1; r++)
    {
        for(var c = 0; c <=size-1; c++)
        {
            val=false;
            cont=0;
            up=undefined;
            down=undefined;
            right=undefined;
            left=undefined;
            dls=undefined;
            dli=undefined;
            drs=undefined;
            dri=undefined;
            el=matriz[r][c];
            if(el.style.backgroundColor=="black")
            {
                if(size<=2)
                {
                    document.getElementById("ex3").innerHTML="entro";
                    if(r==0 && c==0)
                    {
                        right=matriz[r][c+1];
                        down=matriz[r+1][c];
                        dri=matriz[r+1][c+1];
                    }
                    else
                    {
                        if(r==0 && c==1)
                        {
                            left=matriz[r][c-1];
                            down=matriz[r+1][c];
                            dli=matriz[r+1][c-1];
                        }
                        else
                        {
                            if(r==1 && c==0)
                            {
                                up=matriz[r-1][c];
                                right=matriz[r][c+1];
                                drs=matriz[r-1][c+1];
                            }
                            else
                            {
                                if(r==1 && c==1)
                                {
                                    up=matriz[r-1][c];
                                    dls=matriz[r-1][c-1];
                                    left=matriz[r][c-1];
                                }
                            }
                        }
                    }
                }
                else
                {
                    if(r==0 && c==0)
                    {
                        right=matriz[r][c+1];
                        down=matriz[r+1][c];
                        dri=matriz[r+1][c+1];
                    }
                    else
                    {
                        if(r==0 && (c>0 && c<size-1))
                        {
                            down=matriz[r+1][c];
                            right=matriz[r][c+1];
                            left=matriz[r][c-1];
                            dli=matriz[r+1][c-1];
                            dri=matriz[r+1][c+1];
                        }
                        else
                        {
                            if(r==0 && c==size-1)
                            {
                                left=matriz[r][c-1];
                                down=matriz[r+1][c];
                                dli=matriz[r+1][c-1];
                            }
                            else
                            {
                                if((r>0 && r<size-1) && c==0)
                                {
                                    right=matriz[r][c+1];
                                    up=matriz[r-1][c];
                                    down=matriz[r+1][c];
                                    dri=matriz[r+1][c+1];
                                    drs=matriz[r-1][c+1];
                                }
                                else
                                {
                                    if(r==size-1 && c==0)
                                    {
                                        up=matriz[r-1][c];
                                        right=matriz[r][c+1];
                                        drs=matriz[r-1][c+1];
                                    }
                                    else
                                    {
                                        if(r==size-1 && (c>0 && c<size-1))
                                        {
                                            up=matriz[r-1][c];
                                            right=matriz[r][c+1];
                                            left=matriz[r][c-1];
                                            dls=matriz[r-1][c-1];
                                            drs=matriz[r-1][c+1];
                                        }
                                        else
                                        {
                                            if(r==size-1 && c==size-1)
                                            {
                                                up=matriz[r-1][c];
                                                dls=matriz[r-1][c-1];
                                                left=matriz[r][c-1];
                                            }
                                            else
                                            {
                                                if((r>0 && r<size-1) && c==size-1)
                                                {
                                                    left=matriz[r][c-1];
                                                    down=matriz[r+1][c];
                                                    up=matriz[r-1][c];
                                                    dli=matriz[r+1][c-1];
                                                    dls=matriz[r-1][c-1];
                                                }
                                            }   
                                        } 
                                    }  
                                } 
                            } 
                        }
                    }
                }



                if((r>0 && r<size-1) && (c>0 && c<size-1))
                {
                    up=matriz[r-1][c];
                    down=matriz[r+1][c];
                    right=matriz[r][c+1];
                    left=matriz[r][c-1];
                    dls=matriz[r-1][c-1];
                    dli=matriz[r+1][c-1];
                    drs=matriz[r-1][c+1];
                    dri=matriz[r+1][c+1];
                }

                if(up!=undefined && up.style.backgroundColor=="white")
                    cont++;
                if(down!=undefined && down.style.backgroundColor=="white")
                    cont++;
                if(left!=undefined && left.style.backgroundColor=="white")
                    cont++;
                if(right!=undefined && right.style.backgroundColor=="white")
                    cont++;
                if(dls!=undefined && dls.style.backgroundColor=="white")
                    cont++;
                if(dli!=undefined && dli.style.backgroundColor=="white")
                    cont++;
                if(drs!=undefined && drs.style.backgroundColor=="white")
                    cont++;
                if(dri!=undefined && dri.style.backgroundColor=="white")
                    cont++;

                if(cont==3){
                    val=true;
                    asigRes.push(el);
                }
            }
        }
    }
    
    /*for(var r = 1; r < size-1; r++)
    {
        for(var c = 1; c < size-1; c++)
        {
            
            val=false;
            cont=0;
            el=matriz[r][c];
            
            if(el.style.backgroundColor=="white")
            {
                up=matriz[r-1][c];
                down=matriz[r+1][c];
                right=matriz[r][c+1];
                left=matriz[r][c-1];
                dls=matriz[r-1][c-1];
                dli=matriz[r+1][c-1];
                drs=matriz[r-1][c+1];
                dri=matriz[r+1][c+1];

                if(up!=undefined && up.style.backgroundColor=="white")
                    cont++;
                if(down!=undefined && down.style.backgroundColor=="white")
                    cont++;
                if(left!=undefined && left.style.backgroundColor=="white")
                    cont++;
                if(right!=undefined && right.style.backgroundColor=="white")
                    cont++;
                if(dls!=undefined && dls.style.backgroundColor=="white")
                    cont++;
                if(dli!=undefined && dli.style.backgroundColor=="white")
                    cont++;
                if(drs!=undefined && drs.style.backgroundColor=="white")
                    cont++;
                if(dri!=undefined && dri.style.backgroundColor=="white")
                    cont++;
                
                if(cont<2 || cont>3){
                    asigKill.push(el);
                }
            }
        }
    }
    */
    var i = asigKill.length-1;
    var v = asigRes.length-1;
    while(v>=0)
    {
        asigRes[v].style.backgroundColor="white";
        v--;
    }
    while(i>=0)
    {
        asigKill[i].style.backgroundColor="black";
        i--;
    }
}
function cambiaColor(celda)
{
    if(celda.style.backgroundColor=="black"){
        celda.style.backgroundColor="white";
    }
    else
        celda.style.backgroundColor="black";
}
</script>

<script src="js/jquery.min.js"></script>
<script src="js/bootstrap.min.js"></script>

</body>
</html>
